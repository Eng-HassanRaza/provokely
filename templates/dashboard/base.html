{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Dashboard - Provokely{% endblock %}</title>
    <meta name="description" content="{% block description %}Manage your social media engagement with Provokely{% endblock %}">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/animations.css' %}">

    <link rel="icon" href="{% static 'images/favicon.svg' %}">
    
    {% block extra_css %}{% endblock %}
    <style>
      .pk-toast { background-color: #14171a; border: 1px solid rgba(255,140,0,.35); color: #fff; }
      .pk-toast .pk-toast-header { background-color: #ff8c00; color: #fff; }
      .pk-toast .toast-body { color: #fff; }
    </style>
  </head>
  <body class="bg-dark text-light">
    <a href="#main" class="visually-hidden-focusable">Skip to main content</a>

    {% include 'dashboard/components/navbar.html' %}

    <main id="main" class="overflow-hidden" style="padding-top: 80px;">
      {% if messages %}
        <div class="container mt-3">
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous" defer></script>
    <!-- AOS JS -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js" defer></script>
    <!-- Custom JS -->
    <script src="{% static 'js/animations.js' %}" defer></script>
    <script src="{% static 'js/main.js' %}" defer></script>
    
    {% block extra_js %}{% endblock %}
    <script>
      // SSE push for new notifications (fallback could be polling)
      document.addEventListener('DOMContentLoaded', function(){
        const bell = document.querySelector('a.nav-link[aria-label="Notifications"]');
        const badge = bell ? bell.querySelector('.badge') : null;
        try{
          const es = new EventSource('{% url "dashboard:notifications_poll" %}');
          es.onmessage = function(ev){
            try{
              const data = JSON.parse(ev.data);
              if(typeof data.unread_count !== 'undefined' && badge){
                if(data.unread_count > 0){ badge.classList.remove('d-none'); badge.textContent = data.unread_count; }
                else { badge.classList.add('d-none'); }
              }
              if(data.latest){
                const toast = document.createElement('div');
                toast.className = 'toast position-fixed top-0 end-0 m-3 show pk-toast';
                toast.style.zIndex = 1080;
                toast.innerHTML = `<div class=\"toast-header pk-toast-header\"><strong class=\"me-auto\">New Notification</strong><small>now</small><button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"toast\"></button></div><div class=\"toast-body\">${(data.latest.label||'').toUpperCase()}: ${data.latest.text||''}</div>`;
                document.body.appendChild(toast);
                setTimeout(()=>{ toast.remove(); }, 5000);
              }
            }catch(e){ /* ignore */ }
          };
        }catch(e){ /* ignore */ }
      });
    </script>
  </body>
</html>




