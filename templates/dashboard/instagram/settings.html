{% extends 'dashboard/base.html' %}
{% load static %}

{% block title %}Instagram Settings - Provokely{% endblock %}

{% block content %}
<div class="container py-5">
  <h1 class="h3 fw-bold mb-4">Instagram Auto-Reply Settings</h1>

  <form method="post" class="card bg-gradient-dark border-0">
    {% csrf_token %}
    <div class="card-body">
      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if account.is_active %}checked{% endif %}>
        <label class="form-check-label" for="is_active">Account active</label>
      </div>

      <hr class="border-secondary">

      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" id="auto_comment_enabled" name="auto_comment_enabled" {% if user_settings.auto_comment_enabled %}checked{% endif %}>
        <label class="form-check-label" for="auto_comment_enabled">Enable auto-replies</label>
      </div>

      <div class="row g-3">
        <div class="col-12 col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body">
              <h5 class="card-title">Positive</h5>
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="auto_respond_to_positive" name="auto_respond_to_positive" {% if user_settings.auto_respond_to_positive %}checked{% endif %}>
                <label class="form-check-label" for="auto_respond_to_positive">Auto-reply to positive</label>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body">
              <h5 class="card-title">Negative</h5>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input sentiment-toggle" data-approval-target="#neg-approval" type="checkbox" id="auto_respond_to_negative" name="auto_respond_to_negative" {% if user_settings.auto_respond_to_negative %}checked{% endif %}>
                <label class="form-check-label" for="auto_respond_to_negative">Auto-reply to negative</label>
              </div>
              <div id="neg-approval" class="form-check form-switch approval-when-auto{% if not user_settings.auto_comment_enabled or not user_settings.auto_respond_to_negative %} d-none{% endif %}">
                <input class="form-check-input" type="checkbox" id="require_approval_for_negative" name="require_approval_for_negative" {% if user_settings.require_approval_for_negative %}checked{% endif %}>
                <label class="form-check-label" for="require_approval_for_negative">Require approval</label>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card bg-dark border-secondary h-100">
            <div class="card-body">
              <h5 class="card-title">Hate / Offensive</h5>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input sentiment-toggle" data-approval-target="#hate-approval" type="checkbox" id="auto_respond_to_hate" name="auto_respond_to_hate" {% if user_settings.auto_respond_to_hate %}checked{% endif %}>
                <label class="form-check-label" for="auto_respond_to_hate">Auto-reply to hate</label>
              </div>
              <div id="hate-approval" class="form-check form-switch approval-when-auto{% if not user_settings.auto_comment_enabled or not user_settings.auto_respond_to_hate %} d-none{% endif %}">
                <input class="form-check-input" type="checkbox" id="require_approval_for_hate" name="require_approval_for_hate" {% if user_settings.require_approval_for_hate %}checked{% endif %}>
                <label class="form-check-label" for="require_approval_for_hate">Require approval</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr class="border-secondary my-4">
      <h5 class="mb-3">Notifications</h5>
      <div class="row g-3">
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_positive" name="notify_on_positive" {% if user_settings.notify_on_positive %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_positive">Notify on Positive</label>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_negative" name="notify_on_negative" {% if user_settings.notify_on_negative %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_negative">Notify on Negative</label>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_hate" name="notify_on_hate" {% if user_settings.notify_on_hate %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_hate">Notify on Hate / Offensive</label>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_neutral" name="notify_on_neutral" {% if user_settings.notify_on_neutral %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_neutral">Notify on Neutral</label>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_purchase_intent" name="notify_on_purchase_intent" {% if user_settings.notify_on_purchase_intent %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_purchase_intent">Notify on Purchase Intent</label>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="notify_on_question" name="notify_on_question" {% if user_settings.notify_on_question %}checked{% endif %}>
            <label class="form-check-label" for="notify_on_question">Notify on Question / Clarification</label>
          </div>
        </div>
      </div>

      <div class="mt-4">
        <button type="submit" class="btn btn-primary">Save Settings</button>
        <a href="{% url 'dashboard:home' %}" class="btn btn-outline-light ms-2">Back to Dashboard</a>
      </div>
    </div>
  </form>
</div>
<script>
  (function(){
    const master = document.getElementById('auto_comment_enabled');
    if(!master) return;
    function toggleGroups(){
      const autoOn = master.checked;
      // Show approval only if master is on and corresponding sentiment toggle is on
      document.querySelectorAll('.approval-when-auto').forEach(function(el){
        el.classList.add('d-none');
      });
      if(autoOn){
        document.querySelectorAll('.sentiment-toggle').forEach(function(t){
          const target = document.querySelector(t.getAttribute('data-approval-target'));
          if(target){ if(t.checked){ target.classList.remove('d-none'); } else { target.classList.add('d-none'); } }
        });
      }
    }
    master.addEventListener('change', toggleGroups);
    document.querySelectorAll('.sentiment-toggle').forEach(function(t){ t.addEventListener('change', toggleGroups); });
    toggleGroups();
  })();
</script>
{% endblock %}


